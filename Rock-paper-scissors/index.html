<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rock-Paper-Scissors game</title>

    <style>
        html {
            font-family: sans-serif;
        }
        body {
            width: 50%;
            max-width: 800px;
            min-width: 480px;
            margin: 0 auto;
        }

        p {
            padding-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="form" id="userInput">
        <p class="gameDescriptor"> Let's play rock-paper-scissors. I've made my choice; make yours.</p>
        <label for="weaponField">Which one will you play? </label>
        <input type="text" id="weaponField">
        <input type="submit" class="choiceSubmit" value="Submit choice">
        <p class="gameStatus1"> </p>
        <p class="gameStatus2"> </p>
    </div>

    <script>
        let computerChoice;
        let userChoice;

        function getComputerChoice() {
            var thisChoice = Math.floor(Math.random() * 3) + 1;
            const choiceMap = {
                1: "rock",
                2: "paper",
                3: "scissors"
            };

            return choiceMap[thisChoice];
        }

        function validateUserChoice() {
            let optionsString = "rock-paper-scissors";
            let thisChoice = (document.querySelector('#weaponField').value).toLowerCase();
            thisChoice = thisChoice || null;

            //console.log("match check on: " + thisChoice + ".... " + optionsString.indexOf(thisChoice));
            //console.log("data type: " + typeof thisChoice);

            return optionsString.indexOf(thisChoice) !== -1 ? thisChoice : 0;
            
        }

        function throwDown() {
            // determine whether the user or the computer has the winning choice
            const outcomes = {
                rock: { beats: 'scissors', losesTo: 'paper' },
                paper: { beats: 'rock', losesTo: 'scissors' },
                scissors: { beats: 'paper', losesTo: 'rock' }
            };

            let statusPrefix = "I went with " + computerChoice + ". ";
            if (userChoice === computerChoice) {
                //console.log("It's a tie!");
                statusLine1.textContent = statusPrefix + "It's a tie!";
            } else if (outcomes[userChoice].beats === computerChoice) {
                //console.log("You win!");
                statusLine1.textContent = statusPrefix + "You won that round!!";
                myRoundsWon++;
            } else {
                //console.log("You lose!");
                statusLine1.textContent = "I beat you this time with " + computerChoice + ".";
                computerRoundsWon++;
            }

            //console.log("Score (you/me): " + myRoundsWon + "/ " + computerRoundsWon);
        }

        function playGame() {
            // this handles each round of play, making sure the user's submission is valid
            // and then calling throwDown to compare the user's choice to the computer's
            function getRoundWord(thisScore) {
                return thisScore === 1 ? " round." : " rounds.";
            }

            console.clear();
            console.log("Let's play!");

            if (roundsPlayed < MaxRounds-1) {
                computerChoice = getComputerChoice();
                userChoice = validateUserChoice();
                console.log("User entered: " + userChoice + ", against: " + computerChoice);

                if (userChoice !== 0) {
                    ++roundsPlayed;
                    throwDown();
                    statusLine2.textContent = "We're going " + MaxRounds + " rounds. That's round " + roundsPlayed + ".";
                } else {
                    //console.log("bad user input");
                    statusLine1.textContent = "That's not one of the three. Try again.";
                }
            } else {
                inputField.value = "";
                submitBtn.style.display = 'none';                
                statusLine2.textContent = "Game over. You won " + myRoundsWon + getRoundWord(myRoundsWon);
                statusLine2.textContent += " I won " + computerRoundsWon + getRoundWord(computerRoundsWon);
            }
        }
        
        //initialize the variables that we need to stat things off, plus set function to process user input.
        let inputField = document.querySelector('#weaponField');
        let submitBtn = document.querySelector('.choiceSubmit');
        let statusLine1 = document.querySelector('.gameStatus1');
        let statusLine2 = document.querySelector('.gameStatus2');


        let roundsPlayed = 0;
        const MaxRounds = 5;
        let myRoundsWon = 0;
        let computerRoundsWon = 0;
       
        submitBtn.addEventListener('click', playGame);
    </script>
</body>
</html>